{"version":3,"sources":["../../lib/benchpress.js"],"names":["Benchpress","module","exports","runtime","require","precompile","__express","evaluate","compileRender","compileParse","helpers","registerHelper","name","fn","escapeCharMap","replaceChar","c","escapeChars","str","String","toString","replace","cache","globals","setGlobal","key","value","assign","Object","jQuery","extend","addGlobals","data","flush","load","template","Promise","resolve","reject","promise","loader","templateFunction","then","render","block","try","blocks","parse","callback","TypeError","output","setTimeout","err","console","error","registerLoader"],"mappings":"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","file":"benchpress.js","sourcesContent":["'use strict';\n\n/** @exports Benchpress */\nconst Benchpress = (typeof module === 'object' && module.exports) ? module.exports : {};\n\n/* build:SERVER-ONLY:open */\n\nconst runtime = require('./runtime');\nconst precompile = require('./precompile');\nconst __express = require('./express');\nconst evaluate = require('./evaluate');\nconst { compileRender, compileParse } = require('./compile-render');\n\nBenchpress.precompile = precompile;\nBenchpress.__express = __express;\nBenchpress.evaluate = evaluate;\nBenchpress.compileRender = compileRender;\nBenchpress.compileParse = compileParse;\n\n/* build:SERVER-ONLY:close */\n\nBenchpress.runtime = runtime;\n\nBenchpress.helpers = {};\n\n/**\n * Register a helper function\n * @param {string} name - Helper name\n * @param {function} fn - Helper function\n */\nBenchpress.registerHelper = function registerHelper(name, fn) {\n  Benchpress.helpers[name] = fn;\n};\n\n// add default escape function for escaping HTML entities\nconst escapeCharMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;',\n  '=': '&#x3D;',\n};\nconst replaceChar = c => escapeCharMap[c];\nconst escapeChars = /[&<>\"'`=]/g;\n\nBenchpress.registerHelper('__escape', (str) => {\n  if (str == null) {\n    return '';\n  }\n  if (!str) {\n    return String(str);\n  }\n\n  return str.toString().replace(escapeChars, replaceChar);\n});\n\nBenchpress.cache = {};\n\nBenchpress.globals = {};\n\n/**\n * Set a global data value\n * @param {string} key - Property key\n * @param {Object} value - Property value\n */\nBenchpress.setGlobal = function setGlobal(key, value) {\n  Benchpress.globals[key] = value;\n};\n\nconst assign = Object.assign || jQuery.extend; // eslint-disable-line\n\n/**\n * @private\n */\nBenchpress.addGlobals = function addGlobals(data) {\n  return assign({}, Benchpress.globals, data);\n};\n\n/**\n * Clear the template cache\n */\nBenchpress.flush = function flush() {\n  Benchpress.cache = {};\n};\n\n// necessary to support both promises and callbacks\n// can remove when `parse` methods are removed\nfunction load(template) {\n  return new Promise((resolve, reject) => {\n    const promise = Benchpress.loader(template, (templateFunction) => {\n      resolve(templateFunction);\n    });\n\n    if (promise && promise.then) {\n      promise.then(resolve, reject);\n    }\n  });\n}\n\n/**\n * Fetch and run the given template\n * @param {string} template - Name of template to fetch\n * @param {Object} data - Data with which to run the template\n * @param {string} [block] - Parse only this block in the template\n * @returns {Promise<string>} - Rendered output\n */\nfunction render(template, data, block) {\n  data = Benchpress.addGlobals(data || {});\n\n  return Promise.try(() => {\n    Benchpress.cache[template] = Benchpress.cache[template] || load(template);\n    return Benchpress.cache[template];\n  }).then((templateFunction) => {\n    if (block) {\n      templateFunction = templateFunction.blocks && templateFunction.blocks[block];\n    }\n    if (!templateFunction) {\n      return '';\n    }\n\n    return runtime(Benchpress.helpers, data, templateFunction);\n  });\n}\n\n/**\n * Alias for {@link render}, but uses a callback\n * @param {string} template - Name of template to fetch\n * @param {string} [block] - Render only this block in the template\n * @param {Object} data - Data with which to run the template\n * @param {function} callback - callback(output)\n *\n * @deprecated - Use {@link render} instead\n */\nfunction parse(template, block, data, callback) {\n  if (!callback && typeof block === 'object' && typeof data === 'function') {\n    callback = data;\n    data = block;\n    block = null;\n  }\n  if (typeof callback !== 'function') {\n    // Calling parse synchronously with no callback is discontinued\n    throw TypeError('Invalid Arguments: callback must be a function');\n  }\n  if (!template) {\n    callback('');\n    return;\n  }\n\n  render(template, data, block).then(\n    output => setTimeout(callback, 0, output),\n    err => console.error(err), // eslint-disable-line no-console\n  );\n}\n\nBenchpress.render = render;\nBenchpress.parse = parse;\n\n/**\n * Register a loader function to fetch templates\n * - `loader(name, callback) => callback(templateFunction)`\n * - `loader(name) => Promise<templateFunction>`\n * @param {function} loader\n */\nBenchpress.registerLoader = function registerLoader(loader) {\n  Benchpress.loader = loader;\n};\n"]}